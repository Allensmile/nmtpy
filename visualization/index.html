<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>NMT Visualization Tool</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-1.12.4.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type='application/javascript'>
			var sample = null;
			var src_alpha = 'rgba(100, 100, 0, %A%)';
      function preload() {
        var jsonfile = 'data/sample.json';

        $.getJSON(jsonfile, function(data) {
					sample = data;
          var src_phrase = "";
          for (var i = 0; i < sample.src.length; ++i) {
            src_phrase += "<span class='srcword'>" + sample.src[i] + "</span>";
          }
          $('#srctext').html(src_phrase).hide().fadeTo(1000, 1);
				});
			}

      // This removes the emphasis from source words
			function clear_src_att() {
				$('#srctext').children().each(function(i) {$(this).removeAttr('style');});
			}

			function animate_att() {
				clear_src_att();
				var trg_phrase = "";
				for (var i = 0; i < sample.trg.length; ++i) {
					trg_phrase += "<span class='trgword'>" + sample.trg[i] + "</span>";
				}

				// This fades in the target text word-by-word.
				$('#trgtext').html(trg_phrase).children().hide().each(function(i) {
					// List of attentional weights between the i'th target word
					// and all source contexts.
					$(this).delay(i*1500).fadeTo('slow', 1).promise().done(function() {
							$('#srctext').children().each(function(j) {
								// Apply attentional emphasis on each source word
								$(this).css('background-color', src_alpha.replace('%A%', sample.alphas[i][j]*0.6));
							});
						});
					});
				}
    </script>

  </head>
  <body onLoad='preload()'>
    <h1 align="center">NMT Attention Visualization</h1>
    <div class="container" onClick='animate_att()' id="vis">
			<div class="row text-center">
				<h4><b>Click below</b> to visualize a target translation decoding process.</h4>
				<br />
			</div>
      <div class="row text-center">
        <div class="sentence" id="srctext"></div>
      </div>
      <div class="row text-center">
        <div class="sentence" id="trgtext"></div>
      </div>
    </div>

  </body>
</html>
