<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>NMT Visualization Tool</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-1.12.4.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type='application/javascript'>
      // This contains all the necessary informations for visualization
      var jsonfile = 'sample.json';
      var samples = null;
      var item = null;

      $.getJSON(jsonfile, function(data) {
        samples = data.data;
        var metadata_html = "";
        for (var key in data.metadata) {
          metadata_html += key + ": " + data.metadata[key] + "<br />";
        }
        $('div.infosect').html(metadata_html);
      });


      function randomize() {
        // Get a random sample from the dataset for further visualization
        var idx = Math.floor(Math.random()*samples.length);
        console.log(idx);
        item = samples[idx];

        var src_phrase = "";
        var trg_phrase = "";

        for (var i = 0; i < item.src.length; ++i) {
          src_phrase += "<span class='srcword' id='sw" + i + "'>" + item.src[i] + "</span>";
        }
        $('#srctext').html(src_phrase);

        for (var i = 0; i < item.trg.length; ++i) {
          trg_phrase += "<span class='trgword' id='tw" + i + "'>" + item.trg[i] + "</span>";
        }
        $('#trgtext').html(trg_phrase);
      }

      $(document).on('mouseover', 'div#trgtext', function(e) {
        var target = $(e.target).attr('id');
        if (target.startsWith('tw')) {
          var tw = parseInt(target.replace('tw', ''));
          // We hovered over target word tw
          for (var i = 0; i < item.alphas[tw].length; ++i) {
            $('#sw' + i).animate({'opacity': item.alphas[tw][i]}, 10);
          }
        }
      });

      $(document).on('click', '#randombutton', function () {
        randomize();
      });

      // Revert back to full opacities once we leave the target sentence box
      $(document).on('mouseleave', 'div#trgtext', function(e) {
        $('#srctext').children().each(function() {
          $(this).animate({'opacity' : 1}, 20);
        });
      });

    </script>

  </head>
  <body onLoad='randomize();'>
    <div class="page-header text-center">
  <h1>NMT Attention Visualization <small>for nmtpy</small></h1>
    </div>
    <div class="container" id="vis" style="width:50%">
      <div class="row text-right">
				<div class="btn-group" role="group">
					<button type="button" class="btn btn-primary" aria-label="Randomize" id="randombutton">Randomize</button>
        </div>
      </div>
      <div class="row text-center">
        <div class="col-md-2"><h3>Info</h3></div>
        <div class="infosect col-md-10">&nbsp;</div>
      </div>
      <div class="row text-center">
        <div class="col-md-2"><h3>Source</h3></div>
        <div class="sentence col-md-10" id="srctext"></div>
      </div>
      <div class="row text-center">
        <div class="col-md-2"><h3>Target</h3></div>
        <div class="sentence col-md-10" id="trgtext"></div>
      </div>
    </div>

  </body>
</html>
